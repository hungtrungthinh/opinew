<!doctype html>
<html class="no-js" lang="en">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="{{ page_description or g.constants.META_DEFAULT_DESCRIPTION }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page_title or g.constants.META_DEFAULT_TITLE }}</title>
  <meta name="keywords" content="reviews, photo reviews, image reviews, verified review, review plugin, review widget">
  <link id="favicon" rel="shortcut icon" href="{{ url_for('static', filename='icons/opinew32.ico') }}"/>
  <link rel="alternate" href="https://www.opinew.com/" hreflang="x-default"/>

  {# SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones #}
  <link rel="canonical" href="{{ g.constants.META_CANONICAL_URL }}">

  {# DNS Prefetch hints #}
  <link rel="dns-prefetch" href="ajax.googleapis.com">
  {# Hints for CURRENT page #}
  <link rel="subresource" href="{{ url_for('static', filename='img/sprites.png') }}">
  {# Hints for FUTURE navigation #}
  {# <link rel="prefetch" href="{{ url_for('static', filename='js/post_review.js') }}">#}
  {# Chrome prerenders this ONE page in the background for INSTANT click - ONLY GET #}
  <link rel="prerender" href="https://www.opinew.com{{ page_prerender or g.constants.META_DEFAULT_PRERENDER }}">

  {# Apple icons for different devices #}
  <link rel="apple-touch-icon" sizes="60x60" href="{{ url_for('static', filename='icons/apple-touch-icon60.png') }}">
  {# iphone default 60x60 #}
  <link rel="apple-touch-icon" sizes="76x76" href="{{ url_for('static', filename='icons/apple-touch-icon76.png') }}">
  {# ipad #}
  <link rel="apple-touch-icon" sizes="120x120" href="{{ url_for('static', filename='icons/apple-touch-icon120.png') }}">
  {# iphone-retina #}
  <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/apple-touch-icon152.png') }}">
  <link rel="apple-touch-icon" sizes="192x192"
        href="{{ url_for('static', filename='icons/apple-touch-icon192.png') }}"/>

  {# Facebook's open graph #}
  <meta property="og:title" content="{{ page_title or g.constants.META_DEFAULT_TITLE }}"/>
  <meta property="og:type" content="article"/>
  <meta property="og:url" content="{{ page_url or request.url or g.constants.META_CANONICAL_URL }}"/>
  <meta property="og:description" content="{{ page_description or g.constants.META_DEFAULT_DESCRIPTION }}"/>
  <meta property="og:image" content="{{ page_image or g.constants.META_DEFAULT_IMAGE }}"/>
  <meta property="og:site_name" content="{{ g.constants.PRODUCT_NAME }}"/>
  <meta property="fb:app_id" content="1636982329849520"/>

  {# Twitter card data #}
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@opinew">
  <meta name="twitter:title" content="{{ page_title or g.constants.META_DEFAULT_TITLE }}">
  <meta name="twitter:description" content="{{ page_description or g.constants.META_DEFAULT_DESCRIPTION }}">
  <meta name="twitter:creator" content="@opinew">
  <meta name="twitter:image" content="{{ page_image or g.constants.META_DEFAULT_IMAGE }}">

  {# Set the theme color on android devices #}
  <meta name="theme-color" content="{{ g.constants.COLOR_OPINEW_AQUA }}">

  {# Google plus page #}
  <link href="https://plus.google.com/+Opinew" rel="publisher"/>

  {#  Stylesheets #}
  <style type="text/css">
    body {
      font-family: 'Helvetica', sans-serif;
      margin: 32px auto;
      max-width: 768px;
      line-height: 1.6;
      font-size: 16px;
      color: #444;
      background-color: #EEE;
      padding: 0 10px;
    }

    h1, h2, h3 {
      line-height: 1.2
    }

    a, a:visited {
      color: #1c9298;
    }

    header {
      margin: 16px 0;
    }

    .container {
      background-color: #fcfcfc;
      padding: 8px 16px;
      border-radius: 2px;
      box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.14);
      margin: 0 0 16px 0;
    }

    .colors-bar {
      line-height: 0;
      font-size: 0;
    }

    .color-bar-element {
      display: inline-block;
      height: 4px;
      width: 5%;
    }

    .color-bar-element-primary {
      width: 85%;
    }

    .opinew-cherry {
      background-color: #fb412d;
    }

    .opinew-orange {
      background-color: #fb8c2d;
    }

    .opinew-kiwi {
      background-color: #22be44;
    }

    .opinew-aqua {
      background-color: #1c9298;
    }

    .flash-container {
      top: 50px;
      z-index: 10;
      width: 100%;
    }

    .alert-flash {
      margin: 10px auto;
      padding: 8px;
      border-radius: 2px;
      border: 1px solid;
    }

    /* Alerts */
    .alert-error, .alert-danger {
      background-color: #fb412d;
      border-color: #e13a28;
      color: #eee;
    }

    .alert-warning {
      background-color: #fb8c2d;
      border-color: #e17e28;
      color: #eee;
    }

    .alert-primary, .alert-info, .alert-message {
      background-color: #1c9298;
      border-color: #198388;
      color: #eee;
    }

    .alert-success {
      background-color: #22be44;
      border-color: #1eab3d;
      color: #eee;
    }

    textarea {
      font-family: 'Helvetica', sans-serif;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14);
      width: 100%;
      height: 100px;
      margin: 16px auto;
      line-height: 1.6;
      font-size: 18px;
      padding: 8px;
      border-radius: 2px;
      resize: none;
      box-sizing: border-box;
      border: 1px solid #aaa;
    }

    textarea:focus {
      outline: 0;
      border-color: #1c9298;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14), 0 0 8px rgba(28, 146, 152, 0.8);
    }

    button, .btn {
      box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.14);
      font-family: sans-serif;
      cursor: pointer;
      display: inline-block;
      padding: 8px 16px;
      margin-bottom: 0;
      font-size: 14px;
      border-radius: 2px;
    }

    button:focus {
      outline: 0;
    }

    button:active {
      background-color: #198388;
    }

    .btn-default {
      background-color: #f0f0f0;
      border: 1px solid #aaa;
      color: #444;
    }

    .btn-primary {
      background-color: #1c9298;
      border: 1px solid #198388;
      color: #eee;
    }

    .inputfile {
      width: 0;
      height: 0;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
    }

    .pull-right {
      float: right;
    }

    .clearfix:before,
    .clearfix:after {
      content: " ";
      display: table;
    }

    .clearfix:after {
      clear: both;
    }

    .clearfix {
      *zoom: 1;
    }

    blockquote {
      margin: 0;
    }

    .person-name {
      color: #888;
      font-size: 0.8em;
      float: right;
      line-height: 14px;
      margin: 0 8px;
      text-align: right;
    }

    .person-img {
      border-radius: 50%;
      height: 32px;
      width: auto;
      float: right;
    }

    .fab {
      border: 0;
      box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.14);
      height: 64px;
      width: 64px;
      background-color: #1c9298;
      border-radius: 50%;
      position: fixed;
      bottom: 48px;
      right: 48px;
      text-align: center;
      padding: 0;
    }

    .fab-text {
      color: #eee;
      font-size: 32px;
      line-height: 64px;
    }

    input {
      font-family: 'Helvetica', sans-serif;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14);
      padding: 8px;
      line-height: 1.6;
      border-radius: 2px;
      resize: none;
      box-sizing: border-box;
      border: 1px solid #aaa;
      margin: 8px auto;
    }

    .search-box {
      height: 48px;
      margin: 16px auto;
      font-size: 24px;
      padding: 24px;
      width: 100%;
    }

    input:focus {
      outline: 0;
      border-color: #1c9298;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14), 0 0 8px rgba(28, 146, 152, 0.8);
    }

    textarea {
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14);
      width: 100%;
      height: 100px;
      font-family: 'Helvetica', sans-serif;
      margin: 16px auto;
      line-height: 1.6;
      font-size: 18px;
      padding: 8px;
      border-radius: 2px;
      resize: none;
      box-sizing: border-box;
      border: 1px solid #aaa;
    }

    textarea:focus {
      outline: 0;
      border-color: #1c9298;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, .14), 0 0 8px rgba(28, 146, 152, 0.8);
    }

    button, .btn {
      box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.14);
      font-family: 'Helvetica', sans-serif;
      cursor: pointer;
      display: inline-block;
      padding: 8px 16px;
      margin-bottom: 0;
      font-size: 18px;
      border-radius: 2px;
      border: 0;
    }

    button:focus {
      outline: 0;
    }

    button:active {
      background-color: #198388;
    }

    .btn-default {
      background-color: #eee;
      color: #444;
    }

    .btn-primary {
      background-color: #1c9298;
      color: #eee;
    }

    .input-wrapper {
      overflow: hidden;
    }

    .btn-input-right {
      float: right;
      margin: 16px 0;
      line-height: 1.4;
      font-size: 24px;
    }

    .inputfile {
      width: 0;
      height: 0;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
    }

    .pull-right {
      float: right;
    }

    .clearfix:before,
    .clearfix:after {
      content: " ";
      display: table;
    }

    .clearfix:after {
      clear: both;
    }

    .clearfix {
      *zoom: 1;
    }

    header {
      margin: 16px 0;
    }

    .small {
      font-size: 12px;
      text-decoration: none;
    }

    .aggreate-ratings-container {
      text-align: center;
      font-size: 1.5em;
    }

    .star-full:before {
      content: "\2605";
      position: absolute;
      color: #888;
    }

    .star-full-active:before {
      color: #fb8c2d;
    }

    .star-half:after {
      content: '\2605';
      color: #fb8c2d;
      position: absolute;
      margin-left: -38px;
      width: 19px;
      overflow: hidden;
    }

    .btn-interaction {
      border: 0;
      background-color: transparent;
      outline: none;
      box-shadow: none;
      display: inline;
      color: #888;
    }

    .btn-like:hover {
      color: #22be44;
    }

    .btn-report:hover {
      color: #fb412d;
    }

    .btn-share:hover {
      color: #1c9298;
    }

    .danger {
      color: #fb412d;
    }

    .warning {
      color: #fb8c2d;
    }

    .success {
      color: #22be44;
    }

    .form-interaction {
      display: inline;
    }

    .review-date {
      color: #ccc;
    }

    .review-details {
      font-size: 11pt;
    }

    .rating {
      margin: 0 auto;
      width: 440px;
      border: none;
    }

    /* :not(:checked) is a filter, so that browsers that don’t support :checked don’t
       follow these rules. Every browser that supports :checked also supports :not(), so
       it doesn’t make the test unnecessarily selective */
    .rating:not(:checked) > input {
      position: absolute;
      clip: rect(0, 0, 0, 0);
    }

    .rating:not(:checked) > label {
      float: right;
      width: 1em;
      padding: 0 .1em;
      overflow: hidden;
      white-space: nowrap;
      cursor: pointer;
      font-size: 400%;
      line-height: 1.2;
      color: #666;
    }

    .rating:not(:checked) > label:before {
      content: '★ ';
    }

    .rating > input:checked ~ label {
      color: #fb8c2d;
    }

    .rating:not(:checked) > label:hover,
    .rating:not(:checked) > label:hover ~ label {
      color: #FF8E2E;
    }

    .rating > input:checked + label:hover,
    .rating > input:checked + label:hover ~ label,
    .rating > input:checked ~ label:hover,
    .rating > input:checked ~ label:hover ~ label,
    .rating > label:hover ~ input:checked ~ label {
      color: #FFB77A;
    }

    .rating > label:active {
      position: relative;
      top: 2px;
      left: 2px;
    }

    .left-label {
      display: inline-block;
      width: 100px;
    }

    .right-input {
      width: 595px;
    }

    .g-recaptcha {
      margin: 16px 0 0 0;
    }

    .show-more {
      background-color: #eee;
      border-radius: 50%;
      width: 25px;
      text-align: center;
      height: 25px;
      display: inline-block;
      cursor: pointer;
    }

    .sprite {
      background-image: url({{ url_for('static', filename='img/sprites.png') }});
      display: inline-block;
      height: 24px;
      width: 24px;
    }

    .sprite-thumb-up {
      background-position: -72px 0;
    }

    .sprite-share {
      background-position: -48px 0;
    }

    .sprite-flag {
      background-position: -24px 0;
    }

    .sprite-add-photo {
      background-position: 0 0;
    }

    .sprite-mystery-man {
      background-position: -96px 0;
      height: 32px;
      width: 32px;
    }

    .sprite-opinew-logo {
      background-position: 0px 32px;
      position: fixed;
      bottom: 8px;
      right: 32px;
      width: 96px;
      height: 32px;
    }

    .review-image-container {
      position: relative;
      overflow: hidden;
      max-height: 312px;
      background-color: #222;
    }

    .review-image {
      display: block;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      height: auto;
      margin: auto;
    }

    .review-youtube-container {
      position: relative;
      padding-bottom: 312px;
      padding-top: 25px;
      height: 0;
    }

    .review-youtube {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .review-author {
      margin: 8px auto;
    }
  </style>
  {# Place per-page styles #}
  {% block style %}{% endblock %}

  <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body {% block body_attributes %}{% endblock %}>
{% include "snippets/flashed_messages.html" %}

{# Main content of application is here #}
<header>
  <h1>Reviews about <strong itemprop="itemReviewed" itemscope
                            itemtype="http://schema.org/Thing">{{ product.name }}</strong></h1>
  <div class="colors-bar">
    <div class="color-bar-element color-bar-element-primary opinew-aqua"></div>
    <div class="color-bar-element opinew-kiwi"></div>
    <div class="color-bar-element opinew-orange"></div>
    <div class="color-bar-element opinew-cherry"></div>
  </div>
</header>
{% if product_objs.average_stars %}
  {% set average_stars = product_objs.average_stars %}
  <div class="aggreate-ratings-container" itemprop="aggregateRating" itemscope
       itemtype="http://schema.org/AggregateRating">
      <span
          class="star-rating {% if 1 > average_stars > 0 %}star-half {% endif %}{% if average_stars >= 1 %}star-full star-full-active{% endif %}">☆</span>
      <span
          class="star-rating {% if 2 > average_stars > 1 %}star-half {% endif %}{% if average_stars >= 2 %}star-full star-full-active{% endif %}">☆</span>
      <span
          class="star-rating {% if 3 > average_stars > 2 %}star-half {% endif %}{% if average_stars >= 3 %}star-full star-full-active{% endif %}">☆</span>
      <span
          class="star-rating {% if 4 > average_stars > 3 %}star-half {% endif %}{% if average_stars >= 4 %}star-full star-full-active{% endif %}">☆</span>
      <span
          class="star-rating {% if 5 > average_stars > 4 %}star-half {% endif %}{% if average_stars == 5 %}star-full star-full-active{% endif %}">☆</span>
      <span style="color: #fb8c2d">
        <meta itemprop="worstRating" content="1"/>
        <span itemprop="ratingValue">{{ average_stars|round(1) }}</span> / <span itemprop="bestRating">5</span>
      </span>
    from <span itemprop="ratingCount">{{ product_objs.total_reviews }}</span> reviews
  </div>
{% endif %}

{% include "simple/partials/review/create.html" %}

<form method="get" action="{{ url_for('client.route_product_review_search', product_id=product.id) }}"
      id="search-form">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <button type="submit" class="btn-input-right" id="search-form-submit">Search</button>
  <div class="input-wrapper">
    <input type="text" name="q" class="search-box" placeholder="What would you like to know?" id="search-form-query"/>
  </div>
</form>

{# The results of a search will appear here #}
<div id="search-objects" hidden></div>

<div id="objects">
  {% for obj in product_objs.objs_list %}
    {% if obj.obj_type == 'review' %}
      {% set review = obj %}
      {% include "simple/partials/review.html" %}
    {% elif obj.obj_type == 'question' %}
      {% set question = obj %}
    {% endif %}
  {% endfor %}
</div>

<a href="https://www.opinew.com/" target="_blank" class="sprite sprite-opinew-logo"></a>
<button class="fab" id="fab-button" hidden>
  <span class="fab-text">+</span>
</button>
{# /End of main content #}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>
  var SEARCH_DELAY = 600;
  var csrftoken = $('meta[name=csrf-token]').attr('content');

  $.ajaxSetup({
    beforeSend: function (xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken)
      }
    }
  });

  function renderMessageTemplate(message, category) {
    return "<div class=\"alert alert-flash alert-" + category + "\">" + message + "</div>"
  }

  function flashMessage(message, category) {
    $('#flashed-messages').append(renderMessageTemplate(message, category));
  }

  // Bind the FAB to add a review
  $('#fab-button').bind('click', function () {
    $('#add-review').slideToggle().find('textarea').focus();
  });

  // override search form
  $('#search-form-submit').submit(function (e) {
    e.preventDefault();
    console.log('submitting');
  });

  // review toggle
  function reviewToggle() {
    var reviewInteractionsEl = $(this).find('.review-interactions');
    var starEl = $(this).find('.star-rating');
    reviewInteractionsEl.slideToggle(100);
    if (starEl.hasClass('.star-full-active')) {
      starEl.toggleClass('star-full-active');
    }
    $(this).find('.review-short').toggle();
    $(this).find('.review-full').toggle();
  }

  function reviewHoverShow() {
    $(this).find('.star-rating').addClass('star-full-active');
  }

  function reviewHoverHide() {
    $(this).find('.star-rating').removeClass('star-full-active');
  }

  // hover over a review
  $('.review-container').hover(reviewHoverShow, reviewHoverHide).click(reviewToggle);

  function search(query) {
    $('#objects').hide();
    $('#search-objects').show().html("<img src='{{ url_for('static', filename='img/ajax-loader.gif') }}' />");
    $.ajax({
      url: "{{ url_for('client.route_product_review_search', product_id=product.id) }}",
      data: {
        'query': query,
        'product_id': {{ product.id }},
        'async': 1
      }
    }).done(function (r) {
      $('#search-objects').html(r);
    }).fail(function (r) {
      var error = (r.responseJSON && r.responseJSON.error) || 'Uknown error';
      flashMessage(error, 'error');
    });
  }

  // override search form
  var searchTimer = 0;
  $('#search-form-query').on('input', function () {
    var query = $(this).val();
    if (query) {
      if (searchTimer) {
        clearTimeout(searchTimer);
      }
      searchTimer = setTimeout(function () {
        search(query)
      }, SEARCH_DELAY);
    } else {
      $('#objects').show();
      $('#search-objects').hide()
    }
  });

  // display review body on star change
  $('input:radio').change(function () {
    if ($('#review-body-wrapper').is(":hidden"))
      $('#review-body-wrapper').slideDown();
    var reviewNameEl = $('#review-name');
    if (reviewNameEl)
      reviewNameEl.focus();
    else
      $('#review-body').focus();
  });

  // hide the add-review and focus on the seearch box
  $(document).ready(function () {
    $('#add-review').hide();
    $('#fab-button').show();
    $('#review-body-wrapper').hide();
    $('.review-interactions').hide();
    $('.review-short').show();
    $('.review-full').hide();
    $('#search-form-query').focus();
  });
</script>

{# Place per-page scripts #}
{% block script %}{% endblock %}
</body>
</html>