{% import "_macros.html" as macros %}
<div class="alert" id="ajax-status" hidden xmlns="http://www.w3.org/1999/html"></div>
<div class="row" id="product-review">
  {% if g.mobile %}
      <button class="btn btn-success btn-block btn-lg" onclick="launchCamera()" id="launch-mobile-camera">
          <span class="glyphicon glyphicon-camera" style="font-size: 5em;"></span><br>
          <span style="font-size: 1em;">take a picture</span>
      </button>
      <script type="text/javascript">
          function launchCamera() {
              $('#launch-mobile-camera').hide();
              $('#tab-giphy').hide();
              $('#review-image').attr('src', "/static/img/ajax-loader.gif");
              Android.launchCamera();
          }
      </script>
  {% else %}
      <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
              <a href="#tab-giphy" aria-controls="tab-giphy" role="tab" data-toggle="tab">Giphy</a>
          </li>

          <li role="presentation">
              <a href="#tab-upload-image" aria-controls="tab-upload-image" role="tab" data-toggle="tab">Upload image</a>
          </li>
      </ul>
  {% endif %}
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="tab-giphy">
          {% include "forms/review_giphy.html" %}
        </div>
      {% if not g.mobile %}
          <div role="tabpanel" class="tab-pane" id="tab-upload-image">
            {% include "forms/review_image_upload.html" %}
          </div>
      {% endif %}
    </div>

    <form class="action" method="post" action="{{ g.constants.API_V1_URL_PREFIX }}/review" id="review-form">
        <input type="hidden" name="_csrf_token" class="form-serialize" value="{{ csrf_token() }}">
        <input type="hidden" name="api_next" value="{{ url_for('client.reviews') }}"/>
      {% if request.args.get('review_request_id') and request.args.get('review_request_token') %}
          <input type="hidden" name="review_request_id" class="form-serialize" value="{{ request.args.get('review_request_id') }}">
          <input type="hidden" name="review_request_token" class="form-serialize" value="{{ request.args.get('review_request_token') }}">
      {% endif %}
      {% if product %}
          <input type="hidden" class="form-serialize" name="product_id" value="{{ product.id }}">
      {% else %}
          <div class="form-group">
              <label for="sel_product">Select product</label>
              <select class="form-control form-serialize" name="product_id" id="sel_product">
                {% for product in products %}
                    <option value="{{ product.id }}">{{ product.name }}</option>
                {% endfor %}
              </select>
          </div>
      {% endif %}
        <br>

        <div class="col-md-4">
          {% include "forms/review_stars.html" %}
            <img src="" class="img-thumbnail img-responsive"
                 style="max-height:200px; max-width:300px; margin: 10px 0 10px 0;"
                 hidden id="review-image"/>
        </div>
        <div class="col-md-8">

            <div class="col-xs-10" style="padding:0;">
                <label class="text-muted">Write your review...</label>
              {{ review_form.image_url(class="form-control form-serialize hidden") }}<br>
              {{ macros.form_field(review_form, review_form.body, id='textarea-body', class="form-control form-serialize", placeholder='Write your review...') }}<br>
            </div>
            <div class="col-xs-2">
                <label class="text-muted">Emoji</label>
                <a id="emoji-button" class="btn btn-default"><img src="http://twemoji.maxcdn.com/36x36/1f602.png"/></a>
            </div>
        </div>
      {{ review_form.submit(class="btn-primary form-control") }}<br>
    </form>
</div>
